import{_ as s,c as a,b as n,o as l}from"./app-BJ4u_sNN.js";const h="/markdown_img/pixiv/1.png",k="/markdown_img/pixiv/2.png",t="/markdown_img/pixiv/3.png",p="/markdown_img/pixiv/4.png",e={};function r(d,i){return l(),a("div",null,i[0]||(i[0]=[n(`<h1 id="puppeteer结合axios及代理请求根据pid爬取pixiv图片" tabindex="-1"><a class="header-anchor" href="#puppeteer结合axios及代理请求根据pid爬取pixiv图片"><span>puppeteer结合axios及代理请求根据pid爬取pixiv图片</span></a></h1><p>最近在学习网络爬虫,网络上有很多关于python爬虫的案例与教程以及对应的库,但是关于puppeteer的近期案例却很少, 特别是用puppeteer爬取pixiv图片的讲解很少或年代久远(至少在我的搜索下是这样的),所以我想写一遍puppeteer博客以供自己和他人随时查阅<br> 本人技术欠佳,还请谅解</p><h1 id="依赖库" tabindex="-1"><a class="header-anchor" href="#依赖库"><span>依赖库</span></a></h1><blockquote><p>puppeteer只能在node环境使用,请确保node版本不要太低(本人node版本为v22.18.0)</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b;"><pre class="shiki shiki-themes everforest-light everforest-dark vp-code"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">npm</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> i</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> puppeteer</span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> #puppeteer标准库,绑定下载一个chrome浏览器</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">npm</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> i</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> puppeteer-core</span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> #puppeteer-core是puppeteer的核心库,没有绑定chrome浏览器</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">npm</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> i</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> axios</span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> #一个请求库,本文用于向pixiv服务器发起get请求</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="开始" tabindex="-1"><a class="header-anchor" href="#开始"><span>开始</span></a></h1><h2 id="解决登录" tabindex="-1"><a class="header-anchor" href="#解决登录"><span>解决登录</span></a></h2><p>在爬取pixiv图片时并不强制请求是非登录状态,但是可能会导致图片爬取不全,所以最好是进行已登录状态的请求,即向请求添加cookies后请求</p><h3 id="老旧的操作" tabindex="-1"><a class="header-anchor" href="#老旧的操作"><span>老旧的操作</span></a></h3><p>根据我高强度在浏览器搜索登录爬取pixiv图片的方法,以下方法已无效或者存疑</p><ol><li>python通过账号密码和其他参数使用post请求自动登录pixiv(pixiv对登录请求进行了更新,目前这种登录方式获取cookies比较困难)</li></ol><h3 id="获取cookie" tabindex="-1"><a class="header-anchor" href="#获取cookie"><span>获取cookie</span></a></h3><p>获取用户cookie的方法大致有几种</p><ol><li>POST 请求方法,获取返回后的cookie</li><li>puppeteer获取元素执行点击,监听请求事件,提取cookie</li><li>结合pyautogui模拟用户登录,结合python其他库,监听请求事件获取cookie</li><li>手动获取cookie 介于前三种我还没有实践过,所以使用第4种方案获取</li></ol><h4 id="手动获取pixivcookie" tabindex="-1"><a class="header-anchor" href="#手动获取pixivcookie"><span>手动获取pixivCookie</span></a></h4><p>随便打开一个已登录的pixiv页面,例如打开pixiv主页,<a href="https://www.pixiv.net/" target="_blank" rel="noopener noreferrer">https://www.pixiv.net/</a>, 打开主页后按F12或ctrl+shift+i或右键点击菜单栏的检查打开控制台 <img src="`+h+'" alt="pixiv主页控制台" title="pixiv主页控制台"> 点击控制台到网络,然后点击筛选器中的文档 <img src="'+k+'" alt="网络控制台" title="网络控制台"> 在文档中会有一个请求,点击该请求,如过没有,请刷新页面 <img src="'+t+'" alt="pixiv主站请求" title="pixiv主站请求"> 寻找请求中请求标头的cookie,这个cookie就是当前账号的cookie,后续我们就可以通过向请求代入cookie模拟用户已登录</p><h1 id="寻找图片url" tabindex="-1"><a class="header-anchor" href="#寻找图片url"><span>寻找图片url</span></a></h1><p>要根据pid或网址爬取图片,最重要就是获取图片的url,只要获取到了图片url我们就可以向主站发送get请求并下载图片到本地</p><h2 id="通过pixivapi获取所有图片链接" tabindex="-1"><a class="header-anchor" href="#通过pixivapi获取所有图片链接"><span>通过pixivApi获取所有图片链接</span></a></h2><p>最初我试图在pid网址去进行网络监听获取图片url,但是我发现虽然在pid网址是单个图片时可以获取, 但是在面对pid网址是多个图片时,网络监听无法获取全部图片url,根据我的查询发现pixiv有一个api可以用于获取单个pid网址的全部图片url<br><mark>https://www.pixiv.net/ajax/illust/插画id/pages?lang=zh</mark><br> 这个api会打印当前pid网址所需的所有图片,包括原图,压缩图等,例如打开<br><a href="https://www.pixiv.net/ajax/illust/134451163/pages?lang=zh" target="_blank" rel="noopener noreferrer">https://www.pixiv.net/ajax/illust/134451163/pages?lang=zh</a> 可以清晰看见该pid下所有图片链接,其中 <img src="'+p+`" alt="pixiv主站请求" title="pixiv图片链接数组"> 中的original链接便是该张图片的原图链接,我们要找到的就是这个(<s>毕竟都爬图了,不爬个高清图片吗?</s>) <mark>所以,爬取pixiv图片的思路就是,手动获取cookie,根据用户输入的pid值自动查询apiPid网址获取全部图片链接数组,通过axios遍历请求爬取图片</mark></p><h2 id="自动化获取图片链接" tabindex="-1"><a class="header-anchor" href="#自动化获取图片链接"><span>自动化获取图片链接</span></a></h2><p>启动puppeteer</p><blockquote><p>注意这里使用的是puppeteer-core,需要自己自定puppeteer启动的chrome浏览器<br> 注意:这里的代码都是写在PuppeteerCore类中的,注意方法的调用问题</p></blockquote><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" style="--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b;"><pre class="shiki shiki-themes everforest-light everforest-dark vp-code"><code><span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">import</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> puppeteer </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">from</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;puppeteer-core&#39;</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">import</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> type</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> { Browser, Page } </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">from</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;puppeteer-core&#39;</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">class</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> PuppeteerCore</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    browser</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> Browser</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> |</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> null</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> =</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> null</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    runPuppeteer</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> =</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> async</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> ()</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> Promise</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&lt;</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;">void</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&gt; </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">        this</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">browser </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> await</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> puppeteer</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">launch</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">({</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            executablePath</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> chromePath, </span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//chromePath更换为你的浏览器路径</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            headless</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//默认无头模式</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            defaultViewport</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                width</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 1500</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                height</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 720</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">        })</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动新页面</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" style="--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b;"><pre class="shiki shiki-themes everforest-light everforest-dark vp-code"><code><span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> page </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> await</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> this</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">browser</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">newPage</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">await</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> page</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">setUserAgent</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">    &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#39;</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>根据用户输入的pid或pid链接通过正则表达式获取pid网址和apiPid网址</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" style="--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b;"><pre class="shiki shiki-themes everforest-light everforest-dark vp-code"><code><span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">interface</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> pixivHrefInter</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    ajaxHref</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    imgHref</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> * 分析用户输入的网址或pid</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#F85552;--shiki-light-font-style:italic;--shiki-dark:#E67E80;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> {</span><span style="--shiki-light:#3A94C5;--shiki-light-font-style:italic;--shiki-dark:#7FBBB3;--shiki-dark-font-style:italic;">string</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;">}</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> href</span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> //用户输入的pid网址或pid</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">analyzeHrefFunc</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> =</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> async</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (href</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> Promise</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&lt;</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;">pixivHrefInter</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> |</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> null</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&gt; </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">    const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> pixivArtworkIdPattern </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">        /</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(?:(?:</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">https</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">?</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">:</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\\/\\/</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">?</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(?:</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">www</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\\.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">?</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">pixiv</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\\.</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">net</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\\/</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">artworks</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\\/</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">?</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\\d</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">+</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)(?:</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\\?</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">[</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">^</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">#\\s</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">*</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">?</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">/</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">i</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">    // 尝试从输入字符串中匹配pid</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">    const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> match </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> href</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">match</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(pixivArtworkIdPattern)</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">    if</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (match </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">&amp;&amp;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> match[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]) {</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">        // 如果匹配成功，提取pid并构建标准URL</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">        const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> pid </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> match[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">        const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> imgHref </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> \`https://www.pixiv.net/artworks/</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">pid</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">        const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> ajaxHref </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> \`https://www.pixiv.net/ajax/illust/</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">pid</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">/pages?lang=zh\`</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">        return</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            ajaxHref</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> ajaxHref,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            imgHref</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> imgHref</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">        }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    } </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">else</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">        // 如果输入无法识别，可以根据需要返回默认值或抛出异常</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">        console</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">error</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;无法从输入中提取有效的Pixiv艺术作品ID:&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, href)</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">        return</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> null</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于新版puppeteer对page.setCookie在文档中表明了弃用并推荐使用browser.setCookie,所有这里为browser设置全局cookie</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" style="--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b;"><pre class="shiki shiki-themes everforest-light everforest-dark vp-code"><code><span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">/** </span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> * 设置pixivCookie</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#F85552;--shiki-light-font-style:italic;--shiki-dark:#E67E80;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> {</span><span style="--shiki-light:#3A94C5;--shiki-light-font-style:italic;--shiki-dark:#7FBBB3;--shiki-dark-font-style:italic;">string</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;">}</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> cookieSet</span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> //用户的原始cookie</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">setPixivCookie</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> =</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (cookieSet</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> void</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> =&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">    const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> cookies </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> cookieSet</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">split</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;; &#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">map</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">((pair) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">        const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [name, </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">...</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">valueParts] </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> pair</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">split</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;=&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">        const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> value </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> valueParts</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">join</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;=&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">        // 对URL编码的值进行解码</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">        const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> decodedValue </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> decodeURIComponent</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(value </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">||</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">        // 返回完整的Cookie对象</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">        return</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            name</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> name</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">trim</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            value</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> decodedValue,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            domain</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;.pixiv.net&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            path</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;/&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            secure</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> true</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            httpOnly</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            sameSite</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;Lax&#39;</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> as</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> const</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">        }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    })</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">    this</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">browser?.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">setCookie</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">...</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cookies)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//设置cookies</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">this</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">setPixivCookie</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(PixivCookie</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">getCookies</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">())</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="获取图片原始链接数组" tabindex="-1"><a class="header-anchor" href="#获取图片原始链接数组"><span>获取图片原始链接数组</span></a></h2><p>其次根据ajaxHref用puppeteer去打开该网页并进行网络监听获取全部图片原始链接, 因为api网址默认请求一个以该网址为链接的get请求,所以我们就可以直接去通过网络监听匹配该请求, 然后用await response.json()(该方法直接转化json为js对象)获取该请求的json数据, 用数组的map方法遍历返回全部的original组成一个新数组并返回出去</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" style="--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b;"><pre class="shiki shiki-themes everforest-light everforest-dark vp-code"><code><span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> * 查询图片函数</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#F85552;--shiki-light-font-style:italic;--shiki-dark:#E67E80;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> {</span><span style="--shiki-light:#3A94C5;--shiki-light-font-style:italic;--shiki-dark:#7FBBB3;--shiki-dark-font-style:italic;">Page</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;">}</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> page</span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> //页面实例</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#F85552;--shiki-light-font-style:italic;--shiki-dark:#E67E80;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> {</span><span style="--shiki-light:#3A94C5;--shiki-light-font-style:italic;--shiki-dark:#7FBBB3;--shiki-dark-font-style:italic;">string</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;">}</span><span style="--shiki-light:#5C6A72;--shiki-light-font-style:italic;--shiki-dark:#D3C6AA;--shiki-dark-font-style:italic;"> href</span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> //ajaxhref链接</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">interface</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> searchPixivInter</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    urlsArray</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">[]</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    PageUrl</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> pixivHrefInter</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">searchPixivFunc</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> =</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> async</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (page</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> Page</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, href</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> Promise</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&lt;</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;">searchPixivInter</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> |</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> null</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&gt; </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">    const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> PageUrl </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> await</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> this</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">analyzeHrefFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(href) </span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//调用前面的查询函数</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">    if</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">PageUrl) {</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">        puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;error&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`puppeteer报错,链接无效或找不到图片\`</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">        return</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> null</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    }</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">    //监听网络请求,获取全部图片链接</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">    let</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> pageText</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> pixivBodyInter</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">    let</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> urlsArray</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">[] </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> []</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    page</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">on</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;response&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">async</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (response) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">        if</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (response</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">url</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">() </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">===</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> PageUrl</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ajaxHref) {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            console</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">log</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;请求&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, response</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">url</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">())</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            pageText </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> await</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> response</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">json</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            urlsArray </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> pageText</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">body</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">map</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">((allUrl) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">                return</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> allUrl</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">urls</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">original</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            })</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">            puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">                &#39;success&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">                \`成功获取到</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">urlsArray</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">length</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">张图片,所有原始图片链接数组, </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">urlsArray</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            )</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">            return</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">        }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    })</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//调用查询函数</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> searchData </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> await</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> this</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">searchPixivFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(page, data</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">href)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="下载图片" tabindex="-1"><a class="header-anchor" href="#下载图片"><span>下载图片</span></a></h1><p>执行以上操作后就可以进行遍历下载操作</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" style="--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b;"><pre class="shiki shiki-themes everforest-light everforest-dark vp-code"><code><span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//下载图片函数</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">import</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> { HttpsProxyAgent } </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">from</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;https-proxy-agent&#39;</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">import</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> axios </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">from</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;axios&#39;</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> host </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;127.0.0.1&#39;</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> port </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 7897</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> httpsAgent </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> new</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> HttpsProxyAgent</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`http://</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">host</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">:</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">port</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//这是设置http代理去请求pixiv用于防止请求被墙,如何你可以直接访问,或代理端口不是7897,请在这里修改</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">export</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> pixivAxios </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> axios</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">create</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">({</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    proxy</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    timeout</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 25000</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    httpsAgent</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">})</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">interface</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> searchPixivInter</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    urlsArray</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">[]</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    PageUrl</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> pixivHrefInter</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">downloadPixivAxios</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> =</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> async</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (searchData</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> searchPixivInter</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> Promise</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&lt;</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;">void</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&gt; </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">    //获取路径</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">    const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> downloadDir </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> pixivPath</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">getPath</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">() </span><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//路径获取位置,根据你的函数或路径字符串设置</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;success&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`图片将保存至目录: </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">downloadDir</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">,开始遍历下载图片\`</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;success&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`下载图片时可能不会打印,请耐心等待\`</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">    for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">let</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> i </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">; i </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">&lt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> searchData</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">urlsArray</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">length; i</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">++</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">) {</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">        try</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            //将url作为文件名</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> imageUrl </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> searchData</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">urlsArray[i]</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> urlObj </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> new</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> URL</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(imageUrl)</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> fileName </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> urlObj</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">pathname</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">split</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;/&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">pop</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">() </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">||</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> \`image_</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">i</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">.jpg\`</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> filePath </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> join</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(downloadDir, fileName)</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            //请求图片</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> response </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> await</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> pixivAxios</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">({</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                headers</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                    Referer</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> searchData</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">PageUrl</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">imgHref,</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">                    &#39;User-Agent&#39;</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">                        &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                    Cookie</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> PixivCookie</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">getCookies</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                },</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                url</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> searchData</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">urlsArray[i],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                responseType</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &#39;stream&#39;</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            })</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            //获取文件总长度</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            let</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> downloadedSize </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 0</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> contentLength </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> parseInt</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(response</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">headers[</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;content-length&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">])</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            //检查图片是否路径文件夹是否存在</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">            if</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">fs</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">existsSync</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(downloadDir)) {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                fs</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">mkdirSync</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(downloadDir, { recursive</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> true</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> })</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            }</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            // 创建写入流</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> writer </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> fs</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">createWriteStream</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(filePath)</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            //写入数据</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            response</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">data</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">pipe</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(writer)</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            //生成唯一uuid</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">            const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> taskId </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> uuidv4</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            //更新进度</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            response</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">data</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">on</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;data&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, (chunk</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">:</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> Buffer</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                downloadedSize </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">+=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> chunk</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">length</span></span>
<span class="line"><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">                const</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> progress </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                    contentLength </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">&gt;</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 0</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;"> ?</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> Math</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">round</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">((downloadedSize </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">/</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> contentLength) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">*</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 100</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 0</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">                puppeteerProgressFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;success&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, progress, taskId)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            })</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            response</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">data</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">on</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;end&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, () </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">                puppeteerProgressFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;closed&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">100</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, taskId)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">                puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;success&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`成功下载: </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">fileName</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">,正在保存到本地\`</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                downloadedSize </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 0</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            })</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">            // 等待下载完成</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">            await</span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;"> new</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;"> Promise</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&lt;</span><span style="--shiki-light:#3A94C5;--shiki-dark:#7FBBB3;">void</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">&gt;((resolve, reject) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                writer</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">on</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;finish&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, () </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">                    puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;success&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`成功保存: </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">fileName</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">图片到本地\`</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">                    resolve</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                })</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                writer</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">on</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;error&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, (error) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=&gt;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> {</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">                    puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;error&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">\`下载图片</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">fileName</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">失败,请检查vpn或网路是否正常\`</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">                    reject</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(error)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">                })</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            })</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">        } </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">catch</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (e) {</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            console</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">error</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&#39;axios请求报错&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, e)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">            puppeteerPrintFunc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">                &#39;error&#39;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">                \`获取图片</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">\${</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">searchData</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">urlsArray[i]</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">}</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">失败,请检查vpn或网路是否正常\`</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">            )</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">        }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    }</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">}</span></span>
<span class="line"><span style="--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic;">//调用下载图片</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">await</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> this</span><span style="--shiki-light:#939F91;--shiki-dark:#859289;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">downloadPixivAxios</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(searchData)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="尚未完成的优化" tabindex="-1"><a class="header-anchor" href="#尚未完成的优化"><span>尚未完成的优化</span></a></h1><ol><li>对请求的睡觉睡眠防止pixiv检查</li><li>对代码的通用化</li></ol><h1 id="结束" tabindex="-1"><a class="header-anchor" href="#结束"><span>结束</span></a></h1>`,39)]))}const g=s(e,[["render",r]]),y=JSON.parse(`{"path":"/posts/markdown/%E4%BD%BF%E7%94%A8puppeteer%E7%88%AC%E5%8F%96pixiv%E5%9B%BE%E7%89%87.html","title":"使用puppeteer爬取pixiv图片","lang":"zh-CN","frontmatter":{"layout":"Layout","title":"使用puppeteer爬取pixiv图片","data":"2025/09/12","description":"这是一篇关于如何使用puppeteer爬取pixiv图片","head":[["meta",{"property":"og:url","content":"https://fishbread.net/posts/markdown/%E4%BD%BF%E7%94%A8puppeteer%E7%88%AC%E5%8F%96pixiv%E5%9B%BE%E7%89%87.html"}],["meta",{"property":"og:site_name","content":"fishbread的博客"}],["meta",{"property":"og:title","content":"使用puppeteer爬取pixiv图片"}],["meta",{"property":"og:description","content":"这是一篇关于如何使用puppeteer爬取pixiv图片"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://fishbread.net/markdown_img/pixiv/1.png 'pixiv主页控制台'"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"使用puppeteer爬取pixiv图片\\",\\"image\\":[\\"https://fishbread.net/markdown_img/pixiv/1.png 'pixiv主页控制台'\\",\\"https://fishbread.net/markdown_img/pixiv/2.png '网络控制台'\\",\\"https://fishbread.net/markdown_img/pixiv/3.png 'pixiv主站请求'\\",\\"https://fishbread.net/markdown_img/pixiv/4.png 'pixiv图片链接数组'\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"解决登录","slug":"解决登录","link":"#解决登录","children":[{"level":3,"title":"老旧的操作","slug":"老旧的操作","link":"#老旧的操作","children":[]},{"level":3,"title":"获取cookie","slug":"获取cookie","link":"#获取cookie","children":[]}]},{"level":2,"title":"通过pixivApi获取所有图片链接","slug":"通过pixivapi获取所有图片链接","link":"#通过pixivapi获取所有图片链接","children":[]},{"level":2,"title":"自动化获取图片链接","slug":"自动化获取图片链接","link":"#自动化获取图片链接","children":[]},{"level":2,"title":"获取图片原始链接数组","slug":"获取图片原始链接数组","link":"#获取图片原始链接数组","children":[]}],"excerpt":"\\n<p>最近在学习网络爬虫,网络上有很多关于python爬虫的案例与教程以及对应的库,但是关于puppeteer的近期案例却很少,\\n特别是用puppeteer爬取pixiv图片的讲解很少或年代久远(至少在我的搜索下是这样的),所以我想写一遍puppeteer博客以供自己和他人随时查阅<br>\\n本人技术欠佳,还请谅解</p>\\n<h1>依赖库</h1>\\n<blockquote>\\n<p>puppeteer只能在node环境使用,请确保node版本不要太低(本人node版本为v22.18.0)</p>\\n</blockquote>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#5c6a72;--shiki-dark:#d3c6aa;--shiki-light-bg:#fdf6e3;--shiki-dark-bg:#2d353b\\"><pre class=\\"shiki shiki-themes everforest-light everforest-dark vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#8DA101;--shiki-dark:#A7C080\\">npm</span><span style=\\"--shiki-light:#DFA000;--shiki-dark:#DBBC7F\\"> i</span><span style=\\"--shiki-light:#DFA000;--shiki-dark:#DBBC7F\\"> puppeteer</span><span style=\\"--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic\\"> #puppeteer标准库,绑定下载一个chrome浏览器</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#8DA101;--shiki-dark:#A7C080\\">npm</span><span style=\\"--shiki-light:#DFA000;--shiki-dark:#DBBC7F\\"> i</span><span style=\\"--shiki-light:#DFA000;--shiki-dark:#DBBC7F\\"> puppeteer-core</span><span style=\\"--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic\\"> #puppeteer-core是puppeteer的核心库,没有绑定chrome浏览器</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#8DA101;--shiki-dark:#A7C080\\">npm</span><span style=\\"--shiki-light:#DFA000;--shiki-dark:#DBBC7F\\"> i</span><span style=\\"--shiki-light:#DFA000;--shiki-dark:#DBBC7F\\"> axios</span><span style=\\"--shiki-light:#939F91;--shiki-light-font-style:italic;--shiki-dark:#859289;--shiki-dark-font-style:italic\\"> #一个请求库,本文用于向pixiv服务器发起get请求</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}`);export{g as comp,y as data};
